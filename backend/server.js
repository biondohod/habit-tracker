import express from "express";
import cors from "cors";
import dotenv from "dotenv";
import connectDB from "./db.js";
import Post from "./models/Post.js";

dotenv.config();

const app = express();
const PORT = process.env.PORT || 5000;

// Middleware
app.use(cors());
app.use(express.json());

connectDB();

// Ð¢ÐµÑÑ‚Ð¾Ð²Ñ‹Ð¹ Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚
app.get("/api/test", (req, res) => {
  try {
    res.json({ message: "Ð¡ÐµÑ€Ð²ÐµÑ€ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚! ðŸš€" });
  } catch (error) {
    console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð½Ð° /api/test:", error);
    res.status(500).json({ error: "ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐµÑ€Ð²ÐµÑ€Ð°" });
  }
});

// Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð¿Ð¾ÑÑ‚Ð°
app.post("/api/posts", async (req, res) => {
  try {
    const { title, text } = req.body;
    const newPost = new Post({ title, text });
    await newPost.save();
    res.status(201).json({ message: "ÐŸÐ¾ÑÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½!", post: newPost });
  } catch (error) {
    console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð¿Ð¾ÑÑ‚Ð°:", error);
    res.status(500).json({ error: "ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð¿Ð¾ÑÑ‚Ð°" });
  }
});

// Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð²ÑÐµÑ… Ð¿Ð¾ÑÑ‚Ð¾Ð²
app.get("/api/posts", async (req, res) => {
  try {
    const posts = await Post.find();
    res.json(posts);
  } catch (error) {
    console.error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ Ð¿Ð¾ÑÑ‚Ð¾Ð²:", error);
    res.status(500).json({ error: "ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐµ Ð¿Ð¾ÑÑ‚Ð¾Ð²" });
  }
});

app.listen(PORT, () => console.log(`âœ… Ð¡ÐµÑ€Ð²ÐµÑ€ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½ Ð½Ð° http://localhost:${PORT}`));